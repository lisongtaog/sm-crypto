<div class="row">
    <div class="panel panel-default">
        <div class="panel-heading"><h1>Online SM</h1></div>
        <div class="panel-body">
            <div class="col-lg-2">
                <button id="generate" class="btn btn-primary">Generate New Keys</button>
                <br>&nbsp;<br>
            </div>
            <div class="col-lg-10">
                <div class="row">
                    <div class="col-lg-6">
                        <label for="privkey">PriKey</label><br/>
                        <small>
                            <textarea id="privkey" rows="15" style="width:100%"></textarea>
                        </small>
                    </div>
                    <div class="col-lg-6">
                        <label for="pubkey">PubKey</label><br/>
                        <small><textarea id="pubkey" rows="15" style="width:100%"
                                         readonly="readonly"></textarea></small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="panel panel-default">
        <div class="panel-heading"><h3>SM Encryption Test</h3></div>
        <div class="panel-body">
            <div class="col-lg-5">
                <label for="input">Text to encrypt:</label><br/>
                <textarea id="input" name="input" style="width: 100%" rows="4">This is a test!</textarea>
            </div>
            <div class="col-lg-2">
                <label>&nbsp;</label><br/>
                <button id="execute" class="btn btn-primary">Encrypt / Decrypt</button>
            </div>
            <div class="col-lg-5">
                <label for="crypted">Encrypted:</label><br/>
                <textarea id="crypted" name="crypted" style="width: 100%" rows="4"></textarea>
            </div>
        </div>
    </div>
</div>
<title>SM</title>
<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>

<script src="../dist/sm2.js" type="text/javascript"></script>
<script src="../dist/sm3.js" type="text/javascript"></script>
<script src="../dist/sm4.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function () {

    //Change the key size value for new keys
    $('.change-key-size')
      .each(function (index, value) {
        var el = $(value)
        var keySize = el.attr('data-value')
        el.click(function (e) {
          var button = $('#key-size')
          button.attr('data-value', keySize)
          button.html(keySize + ' bit <span class="caret"></span>')
          e.preventDefault()
        })
      })

    // Execute when they click the button.
    $('#execute')
      .click(function () {

        var pubKeyQ = '0401cebfe224b122b3682e7683b3e449df919ef09dcc762cb107f1c2e7a39ecbb73dad92c94279252bdd97cc58666fa9483a804a785dc935d29ec12c2971ded43e'
        var priKeyD = '00aea516cb710b634e4b6e4ebe650d3c8d168e735f69fbc36aa4b5ef3ae6e5e13b'

        // 04未压缩标识。hutool的默认实现是压缩过，js端是未压缩的
        // const sm2 = require('sm-crypto').sm2
        // 1-C1C3C2，0-C1C2C3，默认为1
        const cipherMode = 1

        // sm2
        // 验证pubKey
        let verifyPubKeyQ = sm2.verifyPublicKey(pubKeyQ)
        console.log('verifyPubKeyQ', verifyPubKeyQ)

        var input = $('#input')
          .val()
        var crypted = $('#crypted')
          .val()

        // Alternate the values.
        if (input) {
          $('#crypted')
            .val(sm2.doEncrypt('This is a test!', pubKeyQ, cipherMode))
          $('#input')
            .val('')
        } else if (crypted) {
          var decrypted = sm2.doDecrypt(crypted, priKeyD, cipherMode)
          if (!decrypted) {
            decrypted = 'This is a test!'
          }
          $('#input')
            .val(decrypted)
          $('#crypted')
            .val('')
        }
      })

    var generateKeys = function () {
      let keypair = sm2.generateKeyPairHex()

      $('#privkey')
        .val(keypair.privateKey)
      $('#pubkey')
        .val(keypair.publicKey)
    }

    $('#generate')
      .click(generateKeys)
    generateKeys()
  })
</script>
